<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ComfyUI Model Explorer</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
  </head>
  <body>
    <div class="app-container" x-data="modelExplorer()">
      <div class="sidebar">
        <div class="header">
          <h1>üé® ComfyUI Model Explorer</h1>
          <div class="models-path">/models/checkpoints/</div>
        </div>

        <div class="filter-section">
          <input
            type="text"
            class="search-box"
            placeholder="Search models..."
            x-model="searchQuery"
            @input="filterModels()"
          />
          <div class="model-types">
            <div
              class="type-filter"
              :class="{ 'active': selectedType === 'all' }"
              @click="setFilter('all')"
            >
              All
            </div>
            <div
              class="type-filter"
              :class="{ 'active': selectedType === 'checkpoint' }"
              @click="setFilter('checkpoint')"
            >
              Checkpoints
            </div>
            <div
              class="type-filter"
              :class="{ 'active': selectedType === 'lora' }"
              @click="setFilter('lora')"
            >
              LoRAs
            </div>
            <div
              class="type-filter"
              :class="{ 'active': selectedType === 'vae' }"
              @click="setFilter('vae')"
            >
              VAE
            </div>
            <div
              class="type-filter"
              :class="{ 'active': selectedType === 'controlnet' }"
              @click="setFilter('controlnet')"
            >
              ControlNet
            </div>
          </div>
        </div>

        <div class="models-list">
          <template x-for="model in filteredModels" :key="model.id">
            <div
              class="model-item"
              :class="{ 'active': selectedModel && selectedModel.id === model.id }"
              @click="selectModel(model)"
            >
              <div class="model-name" x-text="model.name"></div>
              <div class="model-type" x-text="model.type"></div>
              <div class="model-size" x-text="model.size"></div>
            </div>
          </template>

          <div x-show="filteredModels.length === 0" class="no-models">
            <p>No models found matching your criteria.</p>
          </div>
        </div>
      </div>

      <div class="main-content">
        <div class="top-bar">
          <div
            class="model-title"
            x-text="selectedModel ? selectedModel.name : 'Select a Model'"
          ></div>
          <div class="action-buttons" x-show="selectedModel">
            <a href="#" class="btn btn-secondary" @click.prevent="openFolder()"
              >üìÅ Open Folder</a
            >
            <a href="#" class="btn btn-secondary" @click.prevent="editNotes()"
              >üìù Edit Notes</a
            >
            <a href="#" class="btn btn-primary" @click.prevent="openCivitAI()"
              >üåê View on CivitAI</a
            >
          </div>
        </div>

        <div class="content-area" x-show="selectedModel">
          <div class="info-grid">
            <div class="info-card">
              <h3>üìä Model Information</h3>
              <div class="info-item">
                <span class="info-label">File Size</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.size || 'Unknown'"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Format</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.format || 'Unknown'"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Base Model</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.base_model || 'Unknown'"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Created</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.created || 'Unknown'"
                ></span>
              </div>
            </div>

            <div class="info-card">
              <h3>‚öôÔ∏è Quick Info</h3>
              <div class="info-item">
                <span class="info-label">Type</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.type || 'Unknown'"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Has Notes</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.has_notes ? 'Yes' : 'No'"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Examples</span>
                <span
                  class="info-value"
                  x-text="selectedModel?.examples?.length || 0"
                ></span>
              </div>
              <div class="info-item">
                <span class="info-label">Path</span>
                <span
                  class="info-value model-path"
                  x-text="selectedModel?.path || 'Unknown'"
                  title="Click to copy"
                  @click="copyPath()"
                ></span>
              </div>
            </div>
          </div>

          <div
            class="gallery-section"
            x-show="selectedModel?.examples?.length > 0"
          >
            <h3>üñºÔ∏è Example Images</h3>
            <div class="gallery-grid">
              <template
                x-for="example in selectedModel.examples"
                :key="example.type"
              >
                <div class="gallery-item" @click="viewExample(example)">
                  <img
                    :src="getExampleImage(example.type)"
                    :alt="example.type + ' example'"
                  />
                  <div class="gallery-overlay">
                    <span class="gallery-prompt" x-text="example.prompt"></span>
                  </div>
                </div>
              </template>
              <div class="gallery-item add-image" @click="addExample()">
                <div class="add-image-content">
                  <span class="add-icon">+</span>
                  <span class="add-text">Add Example</span>
                </div>
              </div>
            </div>
          </div>

          <div class="notes-section">
            <h3>üìù Author Notes & Tips</h3>
            <div class="notes-content" x-show="selectedModel?.notes">
              <pre
                x-text="selectedModel?.notes || 'No notes available for this model.'"
              ></pre>
            </div>
            <div class="notes-empty" x-show="!selectedModel?.notes">
              <p>No notes available for this model.</p>
              <button class="btn btn-secondary" @click="editNotes()">
                Add Notes
              </button>
            </div>
          </div>
        </div>

        <div class="welcome-screen" x-show="!selectedModel">
          <h2>Welcome to ComfyUI Model Explorer</h2>
          <p>
            Select a model from the sidebar to view its details, examples, and
            notes.
          </p>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-number" x-text="models.length"></span>
              <span class="stat-label">Models Found</span>
            </div>
            <div class="stat-item">
              <span
                class="stat-number"
                x-text="models.filter(m => m.has_notes).length"
              ></span>
              <span class="stat-label">With Notes</span>
            </div>
            <div class="stat-item">
              <span
                class="stat-number"
                x-text="new Set(models.map(m => m.type)).size"
              ></span>
              <span class="stat-label">Types</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="status-bar">
      <div class="status-indicator">
        <div class="status-dot" :class="{ 'connected': isConnected }"></div>
        <span
          x-text="isConnected ? 'Connected to ComfyUI (localhost:8188)' : 'ComfyUI not detected'"
        ></span>
      </div>
      <div
        x-text="models.length + ' models loaded ‚Ä¢ ' + models.filter(m => m.has_notes).length + ' with custom notes'"
      ></div>
    </div>

    <!-- Alpine.js for interactivity -->
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
